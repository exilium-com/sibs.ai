import{R as E}from"./index-yXek15Gy.js";import{V as D,R as H}from"./VSkeletonLoader-RjqT2iso.js";import{d as R,a as K,H as B,z as S,b as l,c,w as a,e as s,P as N,R as L,S as P,g as U,f as w,h as v,T as C,U as y,W as M,X as h,Y as x,Z as T,$ as j,a0 as J,a1 as W,a2 as F,l as i,J as X,V as Y,a3 as d,a4 as Z,C as q,a5 as G,a6 as z,n as O}from"./main-DvUrgrR9.js";import{V}from"./VRow-CW_IcRvc.js";import{V as p}from"./VCol-C5-JK7ff.js";import{V as $}from"./VChip-5qzSb2bY.js";import{V as Q}from"./VTextField-Cu_6rxR4.js";import"./VSlideGroup-CLz4jni5.js";const A=R({__name:"chat-summary",props:{skeleton:{type:Boolean},skeletonShort:{type:Boolean},summary:{},time:{},topics:{},id:{},rating:{},comment:{}},setup(k){let r=!0;const t=k,m=K(),f=B({clickable:null});S(()=>f.clickable,e=>{e&&(e.style.cursor="pointer")});function g(){m.push({name:"chat",params:{chatId:t.id}})}return(e,u)=>e.skeleton?(l(),c(L,{key:0,class:"px-1 px-md-2 py-0"},{default:a(()=>[s(N,null,{default:a(()=>[e.skeletonShort?(l(),c(D,{key:0,type:"avatar, sentences, actions"})):(l(),c(D,{key:1,type:"list-item-avatar-three-line, button@3",class:"flex-row-reverse"}))]),_:1})]),_:1})):(l(),c(L,{key:1,class:"px-1 px-md-2 py-0"},{default:a(()=>[s(N,null,{default:a(()=>[s(V,null,{default:a(()=>[s(p,{cols:"auto",class:"px-0"},{default:a(()=>[s(P,{color:"secondary"},{default:a(()=>[s(U,{icon:"mdi-robot"})]),_:1})]),_:1}),s(p,null,{default:a(()=>[w("div",{ref:n=>{f.clickable=n},onClick:g},[s(V,{"no-gutters":"",class:"align-baseline"},{default:a(()=>[s(p,{cols:"auto",class:"text-start h6"},{default:a(()=>[v(" Luana ")]),_:1}),s(p,null,{default:a(()=>[C(r)?(l(),c(H,{key:0,initialRating:e.rating,initialComment:e.comment},null,8,["initialRating","initialComment"])):y("",!0)]),_:1}),s(p,{cols:"auto",class:"text-end"},{default:a(()=>[e.time&&e.time!="0"&&e.summary?(l(),c(C(E),{key:0,time:new Date(e.time),locale:null},null,8,["time"])):y("",!0),s(U,{icon:"mdi-chevron-right",size:"large"})]),_:1})]),_:1}),s(V,{"no-gutters":"",class:"pb-1"},{default:a(()=>[s(p,{class:"text-start"},{default:a(()=>[v(M(e.summary),1)]),_:1})]),_:1})],512),s(V,{justify:"space-between",class:"align-baseline"},{default:a(()=>[s(p,{cols:"auto"},{default:a(()=>[(l(!0),h(x,null,T(e.topics,(n,o)=>(l(),c($,{key:o,label:"",class:"ma-1",size:"small",variant:"flat",color:n[0]=="!"?"warning":"secondary"},{default:a(()=>[v(M(n[0]=="!"?n.slice(1):n),1)]),_:2},1032,["color"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),ee=R({__name:"search-field",props:{searchComplete:{type:Boolean}},emits:["search"],setup(k,{emit:r}){const t=B({searchString:"",searching:!1,chip:""}),m=k,f=r;S(()=>m.searchComplete,()=>{i.debug(i.context(),"searchComplete changed",m.searchComplete,"searchString = ",t.searchString),m.searchComplete&&(t.chip=t.searchString,t.searchString="",t.searching=!1)});function g(){t.searching=!1,t.searchString="",t.chip="",f("search","")}function e(){f("search",t.searchString),t.searching=!0}function u(){i.debug(i.context(),"str=",t.searchString)}return(n,o)=>{const _=j("debounce");return l(),h(x,null,[J(s(Q,{label:"Search","prepend-inner-icon":"mdi-magnify",clearable:"","hide-details":"",modelValue:t.searchString,"onUpdate:modelValue":o[0]||(o[0]=b=>t.searchString=b),"single-line":"",class:"mb-2",density:"compact",loading:t.searching,onDebounced:u,"onClick:prependInner":e,onKeydown:W(e,["enter"]),"onClick:clear":g},null,8,["modelValue","loading"]),[[_,500]]),s(F,null,{default:a(()=>[t.chip?(l(),c($,{key:0,closable:"","onClick:close":g,class:"mb-2",density:"compact"},{default:a(()=>[v(M(t.chip),1)]),_:1})):y("",!0)]),_:1})],64)}}}),te={key:0},ae={key:1},se=R({__name:"chats-view",setup(k){const r=B({searchComplete:!1,filterChats:!1,filteredChats:[]});let t=[{key:0,short:!0},{key:1,short:!1},{key:2,short:!1},{key:3,short:!1},{key:4,short:!0},{key:5,short:!1},{key:6,short:!1},{key:7,short:!0},{key:8,short:!1}];const m=X();S(()=>m.currentAccount,async(e,u)=>{i.debug(i.context(),"currentAccount changed",e,u),e&&(await Z(e.id),await f())},{immediate:!0});async function f(){await q(),window.scrollTo(0,document.body.scrollHeight)}async function g(e){r.searchComplete=!1,i.debug(i.context(),"search=",e),e?G(e).then(()=>{r.searchComplete=!0,r.filterChats=!0,i.debug(i.context(),"searchComplete",r.searchComplete)}).catch(u=>{i.error(i.context(),"search error",u),r.filterChats=!1}):r.filterChats=!1}return S(()=>d.filteredChatsMetadata,()=>{if(!d.allChatsMetadata||!d.filteredChatsMetadata){r.filteredChats=[];return}r.filteredChats=[];for(let e of d.filteredChatsMetadata){let u=d.allChatsMetadata.findIndex(n=>n._id===e);u!==-1&&r.filteredChats.push(d.allChatsMetadata[u])}}),(e,u)=>(l(),c(Y,{class:"v-col-sm-9 v-col-lg-6"},{default:a(()=>[s(ee,{onSearch:g,searchComplete:r.searchComplete},null,8,["searchComplete"]),s(F,null,{default:a(()=>[C(d).allChatsMetadata?(l(),h("div",te,[w("ul",null,[(l(!0),h(x,null,T(r.filterChats?r.filteredChats.entries():C(d).allChatsMetadata.entries(),([n,o])=>{var _,b,I;return l(),h("li",{class:"list-group-item",key:o._id||1},[o._id?(l(),c(A,{key:0,summary:((_=o.summary)==null?void 0:_.content)??"empty",time:((b=o.summary)==null?void 0:b.timestamp)??"0",id:o._id,topics:((I=o.summary)==null?void 0:I.topics)??[]},null,8,["summary","time","id","topics"])):y("",!0),n!==(r.filterChats?r.filteredChats.length-1:C(d).allChatsMetadata.length-1)?(l(),c(z,{key:1,class:"ma-1"})):y("",!0)])}),128))])])):(l(),h("div",ae,[w("ul",null,[(l(!0),h(x,null,T(C(t).entries(),([n,o])=>(l(),h("li",{class:"list-group-item",key:n},[s(A,{skeleton:"",skeletonShort:o.short},null,8,["skeletonShort"]),n!==C(t).length-1?(l(),c(z,{key:0,class:"ma-1"})):y("",!0)]))),128))])]))]),_:1})]),_:1}))}}),he=O(se,[["__scopeId","data-v-8b1ded70"]]);export{he as default};
