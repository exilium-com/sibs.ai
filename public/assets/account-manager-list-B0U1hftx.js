import{R as z}from"./index-CyksbgDq.js";import{d as M,H as O,ad as y,l as p,b as d,c as v,w as a,R as F,e as r,aO as R,P as q,h as k,W as b,T as _,Q as G,j as I,g as $,aK as J,bF as X,a2 as Z,f as H,o as ee,X as U,Z as j,Y as S,U as w,aM as B,J as Y,K,bn as D,bG as te,bH as ne,bI as T,z as ie,O as ae,aJ as re,bJ as oe,bm as ue,n as le}from"./main-C-J6Z3r-.js";import{V as se}from"./VSpacer-CR0xiXUC.js";import{r as h}from"./form-validation-Bhn6uNEO.js";import{V as L}from"./VCol-BwbjBJsN.js";import{V as P}from"./VTextField-Bc-Q8fL1.js";import{V as ce}from"./VRow-FW63HEHb.js";import{V as de,_ as me,a as ve}from"./primary-button.vue_vue_type_script_setup_true_lang-CCtyAB5E.js";import{V as pe,a as fe,b as ge}from"./VExpansionPanels-C5uYFmnz.js";const ye=H("br",null,null,-1),ke=M({__name:"my-invite-card",props:{inviter:{},accountUser:{},inviteDate:{},accept:{type:Boolean}},emits:["update:accept"],setup(C){const t=C,e=O({accountPronoun:y(()=>t.accountUser._id==t.inviter._id?"their":t.accountUser.given_name+"'s"),fullName:y(()=>t.inviter.given_name+(t.inviter.family_name?" "+t.inviter.family_name:""))});return p.debug(p.context(),"props=",t),(l,s)=>(d(),v(Z,null,{default:a(()=>[l.accept==null?(d(),v(F,{key:0,title:e.fullName,variant:"tonal"},{prepend:a(()=>[r(R,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??""},null,8,["picture","firstName","lastName"])]),default:a(()=>[r(q,null,{default:a(()=>[k(b(l.inviter.given_name)+" wants to share "+b(e.accountPronoun)+" sibs data with you ",1),ye,r(_(z),{class:"text-grey small",time:l.inviteDate,locale:null},null,8,["time"])]),_:1}),r(G,{class:"mx-4 mb-2"},{default:a(()=>[r(I,{variant:"tonal",color:"success",onClick:s[0]||(s[0]=m=>l.$emit("update:accept",!0))},{default:a(()=>[r($,{icon:"mdi-check-bold"}),k(" Accept ")]),_:1}),r(se),r(I,{variant:"tonal",color:"secondary",onClick:s[1]||(s[1]=m=>l.$emit("update:accept",!1))},{default:a(()=>[r($,{icon:"mdi-close-thick"}),k(" Reject ")]),_:1})]),_:1})]),_:1},8,["title"])):(d(),v(F,{key:1,variant:"flat",density:"compact"},{default:a(()=>[r(J,{color:"secondary-surface"},{prepend:a(()=>[r(R,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??"",badgeColor:"transparent","offset-y":"33"},{badge:a(()=>[l.accept?(d(),v($,{key:0,icon:"mdi-check-bold",color:"success"})):(d(),v($,{key:1,icon:"mdi-close-thick",color:"error"}))]),_:1},8,["picture","firstName","lastName"])]),append:a(()=>[r(I,{size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:s[2]||(s[2]=m=>l.$emit("update:accept",void 0))})]),default:a(()=>[r(X,null,{default:a(()=>[k(" You will "+b(l.accept==!0?"accept "+l.inviter.given_name:"reject "+l.inviter.given_name)+"'s invitation. ",1)]),_:1})]),_:1})]),_:1}))]),_:1}))}}),Te=M({__name:"my-invite-list",setup(C,{expose:t}){const e=O({pendingInvites:[],submitting:!1,loading:!1}),l=y(()=>e.pendingInvites?e.pendingInvites.filter(c=>c.accept==!0).length:0),s=y(()=>e.pendingInvites?e.pendingInvites.filter(c=>c.accept==!1).length:0),m=y(()=>e.pendingInvites.length),E=y(()=>{const c=l.value>1?`Accept ${l.value} invitations`:l.value>0?"Accept 1 invitation":"",A=s.value>1?`Reject ${s.value} invitations`:s.value>0?"Reject 1 invitation":"",f=l.value>0&&s.value>0?", ":"";return c+f+A});t({invitationsCount:m});async function o(){e.loading=!0;try{let c=await B("/api/person/me/invites",{});if(p.debug(p.context(),"response = ",c),!c.data||c.error)throw new Error(c.error);e.pendingInvites=c.data;const A=Y();A.invitationCount=e.pendingInvites.length??0,p.debug(p.context(),"invitationCount=",A.invitationCount)}catch(c){p.error(p.context(),"getInvites error",c)}finally{e.loading=!1}}ee(async()=>{await o()});async function g(){let c=[],A=[];try{e.submitting=!0,e.pendingInvites.map(N=>{N.accept===!0?c.push(N.account_id):N.accept===!1&&A.push(N.account_id)});const{error:f}=await K("/api/person/me/invites",{body:{accept_invites:c,reject_invites:A}});if(f){p.error(p.context(),f);return}await o()}finally{e.submitting=!1}}return(c,A)=>e.pendingInvites.length>0?(d(),v(F,{key:0,title:"Invitations You Received",loading:e.loading},{default:a(()=>[(d(!0),U(S,null,j(e.pendingInvites,f=>(d(),v(q,{key:f.account_id},{default:a(()=>[r(ke,{accept:f.accept,"onUpdate:accept":N=>f.accept=N,inviter:f.inviter,"account-user":f.account_user,"invite-date":new Date(f.invite_date)},null,8,["accept","onUpdate:accept","inviter","account-user","invite-date"])]),_:2},1024))),128)),E.value?(d(),v(G,{key:0},{default:a(()=>[r(I,{block:"",color:"secondary",variant:"elevated",onClick:g,loading:e.submitting},{default:a(()=>[k(b(E.value),1)]),_:1},8,["loading"])]),_:1})):w("",!0)]),_:1},8,["loading"])):w("",!0)}}),_e={key:0},Ae={key:1,class:"text-grey small"},x=M({__name:"account-manager-item",props:{manager:{},pending:{type:Boolean},date:{},revoke:{type:Boolean},currentAccount:{}},emits:["update:revoke"],setup(C){const t=C;function e(o){return T(t.currentAccount.value)?o?"your":"you":t.currentAccount.value.user.given_name+(o?"'s":"")}function l(o){var c;return((c=Y().person)==null?void 0:c._id)==o._id||t.currentAccount.value.user._id==o._id}function s(o){return o.given_name+(o.family_name?" "+o.family_name:"")}function m(o,g){return g?o?"Your":"You":o?"your":"you"}function E(o,g,c){var f;return((f=Y().person)==null?void 0:f._id)==o._id?m(g,c):s(o)+(g?"'s":"")}return(o,g)=>(d(),v(J,null,D({prepend:a(()=>[r(R,{picture:o.manager.avatar??void 0,firstName:o.manager.given_name,lastName:o.manager.family_name??"",badgeColor:"transparent","offset-y":"30"},D({_:2},[t.revoke?{name:"badge",fn:a(()=>[r($,{icon:"mdi-close-thick",color:"error"})]),key:"0"}:void 0]),1032,["picture","firstName","lastName"])]),default:a(()=>[o.revoke?w("",!0):(d(),v(te,{key:0},{default:a(()=>[k(b(E(o.manager,!1,!0)),1)]),_:1})),l(o.manager)?w("",!0):(d(),v(ne,{key:1},{default:a(()=>[o.revoke?(d(),U("span",_e," You will "+b(o.pending?"not share":"stop sharing")+" "+b(e(!0))+" sibs data with "+b(E(o.manager,!1,!1)),1)):o.date?(d(),U("span",Ae,[k(" Invited "),r(_(z),{time:new Date(o.date),locale:null},null,8,["time"])])):w("",!0)]),_:1}))]),_:2},[l(o.manager)?void 0:{name:"append",fn:a(()=>[o.revoke?(d(),v(I,{key:0,size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:g[0]||(g[0]=c=>o.$emit("update:revoke",!1))})):(d(),v(I,{key:1,onClick:g[1]||(g[1]=c=>o.$emit("update:revoke",!0)),color:"success",variant:"tonal",class:"px-2"},{default:a(()=>[r($,{icon:"mdi-close-thick"}),k(" Revoke ")]),_:1}))]),key:"0"}]),1024))}}),be=M({__name:"invitation-form",props:{givenName:{},familyName:{},email:{},emailConfirmation:{},phone:{}},emits:["update:givenName","update:familyName","update:email","update:emailConfirmation","update:phone","update:formOk"],setup(C){const t=C,e=O({formOk:!1});return(l,s)=>(d(),v(de,{class:"pa-1",value:e.formOk,"onUpdate:modelValue":s[5]||(s[5]=m=>l.$emit("update:formOk",m))},{default:a(()=>[r(ce,null,{default:a(()=>[r(L,null,{default:a(()=>[r(P,{type:"text",label:"Their first name",id:"givenName",value:t.givenName,"onUpdate:modelValue":s[0]||(s[0]=m=>l.$emit("update:givenName",m)),rules:[_(h).required,_(h).name],required:"",class:"required"},null,8,["value","rules"])]),_:1}),r(L,null,{default:a(()=>[r(P,{type:"text",label:"Their last name",id:"familyName",value:t.familyName,"onUpdate:modelValue":s[1]||(s[1]=m=>l.$emit("update:familyName",m)),rules:[_(h).required,_(h).name],required:"",class:"required"},null,8,["value","rules"])]),_:1})]),_:1}),r(P,{type:"email",label:"Their e-mail",id:"email",value:t.email,"onUpdate:modelValue":s[2]||(s[2]=m=>l.$emit("update:email",m)),rules:[_(h).required,_(h).email],required:"",class:"required"},null,8,["value","rules"]),l.email?(d(),v(P,{key:0,type:"email",label:"Confirm  e-mail",id:"emailConfirmation",value:t.emailConfirmation,"onUpdate:modelValue":s[3]||(s[3]=m=>l.$emit("update:emailConfirmation",m)),rules:[_(h).required,_(h).email,_(h).sameAs(l.email,"e-mails")],required:"",class:"required"},null,8,["value","rules"])):w("",!0),r(P,{type:"tel",label:"Their phone",id:"phone",value:t.phone,"onUpdate:modelValue":s[4]||(s[4]=m=>l.$emit("update:phone",m)),rules:[_(h).phoneOrBlank]},null,8,["value","rules"])]),_:1},8,["value"]))}}),he=M({__name:"account-manager-list",props:{currentAccount:{}},setup(C){const t=C,e=O({expand:!1,submitting:!1,inviting:!1,loading:!1,currentAccountAdmins:[],currentAccountInvites:[],inviteeGivenName:"",inviteeFamilyName:"",inviteeEmail:"",inviteeEmailConfirmation:"",inviteePhone:"",inviteeFormOk:!1,invitePanel:[],inviteError:!1,inviteErrorMsg:"",inviteErrorTitleMsg:""}),l=y(()=>e.currentAccountInvites?e.currentAccountInvites.filter(u=>u.revoke&&u.pending).length:0),s=y(()=>e.currentAccountAdmins?e.currentAccountAdmins.filter(u=>u.revoke&&!u.pending).length:0),m=y(()=>{if(e.currentAccountAdmins==null)return;let u=!1;for(let n of e.currentAccountAdmins)if(n.person._id!=t.currentAccount.value.user._id){u=!0;break}return u}),E=y(()=>m.value?T(t.currentAccount.value)?"You are sharing your sibs data with:":`${c.value} is sharing their sibs data with:`:T(t.currentAccount.value)?"Share your sibs data":`${c.value} is not sharing their sibs data with anyone`),o=y(()=>!m.value&&T(t.currentAccount.value)?"You can invite other people to share your data. They will be able to see your data and help you whenever needed.":""),g=y(()=>{const u=l.value+s.value;return u>1?`Stop sharing with ${u} people`:u>0?`Stop sharing with ${u} person`:""}),c=y(()=>t.currentAccount.value.user.given_name+(t.currentAccount.value.user.family_name?" "+t.currentAccount.value.user.family_name:""));function A(u){return T(t.currentAccount.value)?u?"your":"you":t.currentAccount.value.user.given_name+(u?"'s":"")}ie(t.currentAccount,async()=>{e.currentAccountAdmins=void 0,e.currentAccountInvites=void 0,e.loading=!0;try{await f(),await N()}finally{e.loading=!1}},{immediate:!0});async function f(){const{data:u,error:n}=await B("/api/account/{account_id}/admins",{params:{path:{account_id:t.currentAccount.value.id}}});n&&p.error(p.context(),n),e.currentAccountAdmins=u?u.map(i=>({person:i})):[]}async function N(){const{data:u,error:n}=await B("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}}});n&&p.error(p.context(),n);let i=u?u.filter(V=>V.state==="pending"):[];e.currentAccountInvites=i.map(V=>({person:V.invitee,invite_date:V.invite_date,pending:!0}))}async function Q(){let u=[];for(let n of e.currentAccountAdmins??[])n.revoke&&u.push(n.person._id);for(let n of e.currentAccountInvites??[])n.revoke&&u.push(n.person._id);try{if(e.submitting=!0,u.length>0){const{error:n}=await ue("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}},body:u});n&&p.error(p.context(),n),await f(),await N()}}finally{e.submitting=!1}}async function W(){var u;try{e.inviting=!0;const n=await K("/api/account/{account_id}/invite",{params:{path:{account_id:t.currentAccount.value.id}},body:{given_name:e.inviteeGivenName,family_name:e.inviteeFamilyName||void 0,email:e.inviteeEmail,phone:e.inviteePhone||void 0}});if(n.error){const i={403:"You can't invite other parties to this account",405:"Maximum number of invites reached for this account",409:"This person is already invited to this account"};e.inviteError=!0,e.inviteErrorMsg=i[n.response.status]??"Error inviting this person",e.inviteErrorTitleMsg="Problem inviting "+e.inviteeGivenName,p.error(p.context(),"inviteError",e.inviteErrorMsg,e.inviteErrorTitleMsg)}else{let i={person:n.data.invitee,invite_date:n.data.invite_date,pending:!0};(u=e.currentAccountInvites)==null||u.push(i),e.inviteeGivenName="",e.inviteeFamilyName="",e.inviteeEmail="",e.inviteeEmailConfirmation="",e.inviteePhone="",e.invitePanel=[],e.inviteError=!1,e.inviteErrorMsg="",e.inviteErrorTitleMsg=""}}finally{e.inviting=!1}}return(u,n)=>t.currentAccount.value.user._id?(d(),v(F,{key:0,color:"surface",loading:e.loading},{default:a(()=>[r(ae,{class:"text-wrap"},{default:a(()=>[k(b(E.value),1)]),_:1}),r(q,null,{default:a(()=>[k(b(o.value)+" ",1),r(re,null,{default:a(()=>[(d(!0),U(S,null,j(e.currentAccountAdmins,i=>(d(),U(S,null,[i.person._id!=t.currentAccount.value.user._id?(d(),v(x,{key:i.person._id??i.person.email,revoke:i.revoke,"onUpdate:revoke":V=>i.revoke=V,manager:i.person,"current-account":t.currentAccount,lines:"two"},null,8,["revoke","onUpdate:revoke","manager","current-account"])):w("",!0)],64))),256)),e.currentAccountInvites&&e.currentAccountInvites.length>0?(d(),v(oe,{key:0},{default:a(()=>[k(" Pending")]),_:1})):w("",!0),(d(!0),U(S,null,j(e.currentAccountInvites,i=>(d(),v(x,{key:i.person._id??i.person.email,variant:"tonal",lines:"two",revoke:i.revoke,"onUpdate:revoke":V=>i.revoke=V,manager:i.person,"current-account":t.currentAccount,pending:!0,date:new Date(i.invite_date)},null,8,["revoke","onUpdate:revoke","manager","current-account","date"]))),128))]),_:1})]),_:1}),g.value?(d(),v(G,{key:0},{default:a(()=>[r(I,{block:"",color:"secondary",variant:"elevated",onClick:Q,loading:e.submitting},{default:a(()=>[k(b(g.value),1)]),_:1},8,["loading"])]),_:1})):w("",!0),r(q,null,{default:a(()=>[r(pe,{multiple:"",modelValue:e.invitePanel,"onUpdate:modelValue":n[9]||(n[9]=i=>e.invitePanel=i)},{default:a(()=>[r(fe,{"bg-color":"info-surface",color:"info-surface",value:"invite",title:`Share ${A(!0)} sibs data with another person`},{default:a(()=>[r(ge,{id:"expansionPanelText",color:"info-surface"},{default:a(()=>[r(be,{"given-name":e.inviteeGivenName,"onUpdate:givenName":n[0]||(n[0]=i=>e.inviteeGivenName=i),"family-name":e.inviteeFamilyName,"onUpdate:familyName":n[1]||(n[1]=i=>e.inviteeFamilyName=i),email:e.inviteeEmail,"onUpdate:email":n[2]||(n[2]=i=>e.inviteeEmail=i),"email-confirmation":e.inviteeEmailConfirmation,"onUpdate:emailConfirmation":n[3]||(n[3]=i=>e.inviteeEmailConfirmation=i),phone:e.inviteePhone,"onUpdate:phone":n[4]||(n[4]=i=>e.inviteePhone=i),"onUpdate:formOk":n[5]||(n[5]=i=>e.inviteeFormOk=i)},null,8,["given-name","family-name","email","email-confirmation","phone"]),H("div",null,[r(me,{"error-msg":e.inviteErrorMsg,"onUpdate:errorMsg":n[6]||(n[6]=i=>e.inviteErrorMsg=i),"error-title":e.inviteErrorTitleMsg,"onUpdate:errorTitle":n[7]||(n[7]=i=>e.inviteErrorTitleMsg=i)},null,8,["error-msg","error-title"]),r(ve,{color:"info",block:"",onClick:n[8]||(n[8]=i=>W()),disabled:!e.inviteeFormOk,loading:e.inviting,enabledColor:"info"},{default:a(()=>[k("Invite")]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading"])):w("",!0)}}),Me=le(he,[["__scopeId","data-v-d76b341e"]]);export{Me as A,Te as _};
