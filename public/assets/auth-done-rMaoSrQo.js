import{q as C,r as A,s as B,t as L,v as S,x as D,y as T,I as k,z as E,A as O,B as F,C as N,D as V,E as w,e as d,F as R,G as I,d as M,u as z,a as U,H,o as W,J as j,l as e,K as q,L as G,c as J,w as p,M as K,N as Q,b as Z,O as X,h as _,P as Y,Q as $,j as ee,R as te,f as y}from"./main-DvUrgrR9.js";import{V as oe}from"./VSpacer-MQCRrFTX.js";const ne=C({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...A({origin:"center center",scrollStrategy:"block",transition:{component:B},zIndex:2400})},"VDialog"),ae=L()({name:"VDialog",props:ne(),emits:{"update:modelValue":s=>!0,afterLeave:()=>!0},setup(s,h){let{emit:v,slots:l}=h;const g=S(s,"modelValue"),{scopeId:b}=D(),r=T();function o(n){var f,m;const u=n.relatedTarget,t=n.target;if(u!==t&&((f=r.value)!=null&&f.contentEl)&&((m=r.value)!=null&&m.globalTop)&&![document,r.value.contentEl].includes(t)&&!r.value.contentEl.contains(t)){const c=I(r.value.contentEl);if(!c.length)return;const x=c[0],P=c[c.length-1];u===x?P.focus():x.focus()}}k&&E(()=>g.value&&s.retainFocus,n=>{n?document.addEventListener("focusin",o):document.removeEventListener("focusin",o)},{immediate:!0});function a(){var n;(n=r.value)!=null&&n.contentEl&&!r.value.contentEl.contains(document.activeElement)&&r.value.contentEl.focus({preventScroll:!0})}function i(){v("afterLeave")}return E(g,async n=>{var u;n||(await N(),(u=r.value.activatorEl)==null||u.focus({preventScroll:!0}))}),O(()=>{const n=V.filterProps(s),u=w({"aria-haspopup":"dialog","aria-expanded":String(g.value)},s.activatorProps),t=w({tabindex:-1},s.contentProps);return d(V,w({ref:r,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},n,{modelValue:g.value,"onUpdate:modelValue":f=>g.value=f,"aria-modal":"true",activatorProps:u,contentProps:t,role:"dialog",onAfterEnter:a,onAfterLeave:i},b),{activator:l.activator,default:function(){for(var f=arguments.length,m=new Array(f),c=0;c<f;c++)m[c]=arguments[c];return d(R,{root:"VDialog"},{default:()=>{var x;return[(x=l.default)==null?void 0:x.call(l,...m)]}})}})}),F({},r)}}),re=y("p",null,"We are working hard for everyone to be able to use sibs.ai soon.",-1),se=y("br",null,null,-1),ue=M({__name:"auth-done",setup(s){const{logout:h}=z(),v=U(),l=H({signinError:!1});function g(o){return o=o||{enableHighAccuracy:!1,timeout:1e4,maximumAge:0},new Promise((a,i)=>navigator.geolocation.getCurrentPosition(a,i,o))}function b(){const o={};g().then(a=>{o.latitude=a.coords.latitude,o.longitude=a.coords.longitude,e.debug(e.context(),"getLocation:",o)}).catch(a=>{e.error(e.context(),"getLocation error",a)}).finally(async()=>{let a={login_location:o};const{data:i,error:n}=await K("/api/person/me",{body:a});n?e.error(e.context(),n):e.debug(e.context(),"updatePosition returns",i),await Q(),e.debug(e.context(),"getLocation done")})}W(async()=>{var a,i;const o=j();e.debug(e.context(),">>>>>>>>    OnBeforeMount entering"),o.clear();try{const n=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,u=Intl.DateTimeFormat().resolvedOptions().timeZone,t=await q("/api/person/register",{body:{language:n,tz:u}});if(e.debug(e.context(),"register returns",t),e.debug(e.context(),"register error",t.error),!t.response.ok||!t.data)throw e.error(e.context(),"auth-done: register error",t.error,t.response.status),t.response.status==403&&(e.error(e.context(),"person not allowed"),l.signinError=!0),new Error("register failed");if(e.debug(e.context(),"person",t.data.person),o.person=t.data.person,e.debug(e.context(),"userStore.accounts = ",o.accounts),t.data.person.validation==="New")e.debug(e.context(),"new person: go to profile",t.data.person),v.push({name:"signup_profile"});else if(t.data.person.validation==="Verified")e.debug(e.context(),"new person verified, go to invitations"),v.push({name:"signup_profile"});else if(t.data.person.validation==="Filled")e.debug(e.context(),"new person filled, go to verify"),o.invitationCount=((a=t.data.invite_list)==null?void 0:a.length)??0,v.push({name:"signup_invitations"});else if(t.data.person.validation==="Ready"){if(await o.setAccounts(t.data.user_list,t.data.admin_list,t.data.owner_list),o.invitationCount=((i=t.data.invite_list)==null?void 0:i.length)??0,e.debug(e.context(),"userStore.accounts",o.accounts,"invitation count = ",o.invitationCount),b(),!o.currentAccount)throw new Error("invalid account state");if(o.currentAccount.role=="admin")v.push({name:"chats"});else if(o.currentAccount.role=="user")G();else throw new Error("unknown role")}else throw new Error("unknown validation state")}catch(n){e.error(e.context(),"register error",n),l.signinError||await h(),e.error(e.context(),"<<<<<<<   OnBeforeMount exiting")}e.debug(e.context(),"<<<<<<<   OnBeforeMount exiting")});async function r(){await h()}return(o,a)=>(Z(),J(ae,{modelValue:l.signinError,"onUpdate:modelValue":a[0]||(a[0]=i=>l.signinError=i),persistent:"",width:"400"},{default:p(()=>[d(te,null,{default:p(()=>[d(X,null,{default:p(()=>[_("sibs.ai is open for alpha-testers")]),_:1}),d(Y,null,{default:p(()=>[re,se]),_:1}),d($,null,{default:p(()=>[d(oe),d(ee,{color:"primary",onClick:r},{default:p(()=>[_("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{ue as default};
