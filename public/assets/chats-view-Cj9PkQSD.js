import{R as F}from"./index-CluUaWoL.js";import{R as L}from"./rating-popup-CE0OOCdk.js";import{d as N,a as U,l as V,v as B,r as o,b as l,c as i,w as a,e as s,f as R,g as M,x as g,y as w,z as D,A as _,F as I,B as T,C as E,D as H,E as K,m as $,G as m,H as j,I as G,J,k as P}from"./main-CuD3QBrw.js";const z=N({__name:"chat-summary",props:{skeleton:{type:Boolean},skeletonShort:{type:Boolean},summary:{},time:{},topics:{},id:{},rating:{},comment:{}},setup(x){let n=!0;const t=x,f=U(),v=V({clickable:null});B(()=>v.clickable,e=>{e&&(e.style.cursor="pointer")});function C(){f.push({name:"chat",params:{chatId:t.id}})}return(e,d)=>{const p=o("v-skeleton-loader"),y=o("v-card-text"),k=o("v-card"),u=o("v-icon"),r=o("v-avatar"),c=o("v-col"),h=o("v-row"),S=o("v-chip");return e.skeleton?(l(),i(k,{key:0,class:"px-1 px-md-2 py-0"},{default:a(()=>[s(y,null,{default:a(()=>[e.skeletonShort?(l(),i(p,{key:0,type:"avatar, sentences, actions"})):(l(),i(p,{key:1,type:"list-item-avatar-three-line, button@3",class:"flex-row-reverse"}))]),_:1})]),_:1})):(l(),i(k,{key:1,class:"px-1 px-md-2 py-0"},{default:a(()=>[s(y,null,{default:a(()=>[s(h,null,{default:a(()=>[s(c,{cols:"auto",class:"px-0"},{default:a(()=>[s(r,{color:"secondary"},{default:a(()=>[s(u,{icon:"mdi-robot"})]),_:1})]),_:1}),s(c,null,{default:a(()=>[R("div",{ref:b=>{v.clickable=b},onClick:C},[s(h,{"no-gutters":"",class:"align-baseline"},{default:a(()=>[s(c,{cols:"auto",class:"text-start h6"},{default:a(()=>[M(" Luana ")]),_:1}),s(c,null,{default:a(()=>[g(n)?(l(),i(L,{key:0,initialRating:e.rating,initialComment:e.comment},null,8,["initialRating","initialComment"])):w("",!0)]),_:1}),s(c,{cols:"auto",class:"text-end"},{default:a(()=>[e.time&&e.time!="0"&&e.summary?(l(),i(g(F),{key:0,time:new Date(e.time),locale:null},null,8,["time"])):w("",!0),s(u,{icon:"mdi-chevron-right",size:"large"})]),_:1})]),_:1}),s(h,{"no-gutters":"",class:"pb-1"},{default:a(()=>[s(c,{class:"text-start"},{default:a(()=>[M(D(e.summary),1)]),_:1})]),_:1})],512),s(h,{justify:"space-between",class:"align-baseline"},{default:a(()=>[s(c,{cols:"auto"},{default:a(()=>[(l(!0),_(I,null,T(e.topics,(b,A)=>(l(),i(S,{key:A,label:"",class:"ma-1",size:"small",variant:"flat",color:b[0]=="!"?"warning":"secondary"},{default:a(()=>[M(D(b[0]=="!"?b.slice(1):b),1)]),_:2},1032,["color"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}}),q=N({__name:"search-field",props:{searchComplete:{type:Boolean}},emits:["search"],setup(x,{emit:n}){const t=V({searchString:"",searching:!1,chip:""}),f=x,v=n;B(()=>f.searchComplete,()=>{console.log("searchComplete changed",f.searchComplete,"searchString = ",t.searchString),f.searchComplete&&(t.chip=t.searchString,t.searchString="",t.searching=!1)});function C(){t.searching=!1,t.searchString="",t.chip="",v("search","")}function e(){v("search",t.searchString),t.searching=!0}function d(){console.log("debounced called, str=",t.searchString)}return(p,y)=>{const k=o("v-text-field"),u=o("v-chip"),r=o("v-expand-transition"),c=E("debounce");return l(),_(I,null,[H(s(k,{label:"Search","prepend-inner-icon":"mdi-magnify",clearable:"","hide-details":"",modelValue:t.searchString,"onUpdate:modelValue":y[0]||(y[0]=h=>t.searchString=h),"single-line":"",class:"mb-2",density:"compact",loading:t.searching,onDebounced:d,"onClick:prependInner":e,onKeydown:K(e,["enter"]),"onClick:clear":C},null,8,["modelValue","loading"]),[[c,500]]),s(r,null,{default:a(()=>[t.chip?(l(),i(u,{key:0,closable:"","onClick:close":C,class:"mb-2",density:"compact"},{default:a(()=>[M(D(t.chip),1)]),_:1})):w("",!0)]),_:1})],64)}}}),O={key:0},Q={key:1},W=N({__name:"chats-view",setup(x){const n=V({searchComplete:!1,filterChats:!1,filteredChats:[]});let t=[{key:0,short:!0},{key:1,short:!1},{key:2,short:!1},{key:3,short:!1},{key:4,short:!0},{key:5,short:!1},{key:6,short:!1},{key:7,short:!0},{key:8,short:!1}];const f=$();B(()=>f.currentAccount,async(e,d)=>{console.log("chats-view: currentAccount changed",e,d),e&&(await j(e.id),await v())},{immediate:!0});async function v(){await G(),window.scrollTo(0,document.body.scrollHeight)}async function C(e){n.searchComplete=!1,console.log("chats-view: search",e),e?J(e).then(()=>{n.searchComplete=!0,n.filterChats=!0,console.log("chats-view: searchComplete",n.searchComplete)}).catch(d=>{console.error("chats-view: search error",d),n.filterChats=!1}):n.filterChats=!1}return B(()=>m.filteredChatsMetadata,()=>{if(!m.allChatsMetadata||!m.filteredChatsMetadata){n.filteredChats=[];return}n.filteredChats=[];for(let e of m.filteredChatsMetadata){let d=m.allChatsMetadata.findIndex(p=>p._id===e);d!==-1&&n.filteredChats.push(m.allChatsMetadata[d])}}),(e,d)=>{const p=o("v-divider"),y=o("v-expand-transition"),k=o("v-container");return l(),i(k,{class:"v-col-sm-9 v-col-lg-6"},{default:a(()=>[s(q,{onSearch:C,searchComplete:n.searchComplete},null,8,["searchComplete"]),s(y,null,{default:a(()=>[g(m).allChatsMetadata?(l(),_("div",O,[R("ul",null,[(l(!0),_(I,null,T(n.filterChats?n.filteredChats.entries():g(m).allChatsMetadata.entries(),([u,r])=>{var c,h,S;return l(),_("li",{class:"list-group-item",key:r._id||1},[r._id?(l(),i(z,{key:0,summary:((c=r.summary)==null?void 0:c.content)??"empty",time:((h=r.summary)==null?void 0:h.timestamp)??"0",id:r._id,topics:((S=r.summary)==null?void 0:S.topics)??[]},null,8,["summary","time","id","topics"])):w("",!0),u!==(n.filterChats?n.filteredChats.length-1:g(m).allChatsMetadata.length-1)?(l(),i(p,{key:1,class:"ma-1"})):w("",!0)])}),128))])])):(l(),_("div",Q,[R("ul",null,[(l(!0),_(I,null,T(g(t).entries(),([u,r])=>(l(),_("li",{class:"list-group-item",key:u},[s(z,{skeleton:"",skeletonShort:r.short},null,8,["skeletonShort"]),u!==g(t).length-1?(l(),i(p,{key:0,class:"ma-1"})):w("",!0)]))),128))])]))]),_:1})]),_:1})}}}),ee=P(W,[["__scopeId","data-v-cebbbc7a"]]);export{ee as default};
