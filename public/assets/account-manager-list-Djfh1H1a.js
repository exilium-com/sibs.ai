import{R as z}from"./index-e_AqwlmS.js";import{d as S,m as F,L as A,l as f,r as u,b as m,c as p,w as o,e as l,N as O,g as h,A as N,y as w,f as L,o as te,B as T,C as j,F as V,z as $,M as q,n as R,q as H,$ as D,ag as x,x as ne,Y as ie,k as ae}from"./main-_0WdI2da.js";import{r as C}from"./form-validation-Bhn6uNEO.js";import{_ as oe,a as re}from"./primary-button.vue_vue_type_script_setup_true_lang-D9N2jzjA.js";const le=L("br",null,null,-1),se=S({__name:"my-invite-card",props:{inviter:{},accountUser:{},inviteDate:{},accept:{type:Boolean}},emits:["update:accept"],setup(I){const t=I,e=F({accountPronoun:A(()=>t.accountUser._id==t.inviter._id?"their":t.accountUser.given_name+"'s"),fullName:A(()=>t.inviter.given_name+(t.inviter.family_name?" "+t.inviter.family_name:""))});return f.debug(f.context(),"props=",t),(c,v)=>{const k=u("v-card-text"),y=u("v-icon"),i=u("v-btn"),d=u("v-spacer"),a=u("v-card-actions"),_=u("v-card"),g=u("v-card-subtitle"),b=u("v-list-item"),M=u("v-expand-transition");return m(),p(M,null,{default:o(()=>[c.accept==null?(m(),p(_,{key:0,title:e.fullName,variant:"tonal"},{prepend:o(()=>[l(O,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??""},null,8,["picture","firstName","lastName"])]),default:o(()=>[l(k,null,{default:o(()=>[h(N(c.inviter.given_name)+" wants to share "+N(e.accountPronoun)+" sibs data with you ",1),le,l(w(z),{class:"text-grey small",time:c.inviteDate,locale:null},null,8,["time"])]),_:1}),l(a,{class:"mx-4 mb-2"},{default:o(()=>[l(i,{variant:"tonal",color:"success",onClick:v[0]||(v[0]=U=>c.$emit("update:accept",!0))},{default:o(()=>[l(y,{icon:"mdi-check-bold"}),h(" Accept ")]),_:1}),l(d),l(i,{variant:"tonal",color:"secondary",onClick:v[1]||(v[1]=U=>c.$emit("update:accept",!1))},{default:o(()=>[l(y,{icon:"mdi-close-thick"}),h(" Reject ")]),_:1})]),_:1})]),_:1},8,["title"])):(m(),p(_,{key:1,variant:"flat",density:"compact"},{default:o(()=>[l(b,{color:"secondary-surface"},{prepend:o(()=>[l(O,{picture:t.inviter.avatar??void 0,firstName:t.inviter.given_name,lastName:t.inviter.family_name??"",badgeColor:"transparent","offset-y":"33"},{badge:o(()=>[c.accept?(m(),p(y,{key:0,icon:"mdi-check-bold",color:"success"})):(m(),p(y,{key:1,icon:"mdi-close-thick",color:"error"}))]),_:1},8,["picture","firstName","lastName"])]),append:o(()=>[l(i,{size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:v[2]||(v[2]=U=>c.$emit("update:accept",void 0))})]),default:o(()=>[l(g,null,{default:o(()=>[h(" You will "+N(c.accept==!0?"accept "+c.inviter.given_name:"reject "+c.inviter.given_name)+"'s invitation. ",1)]),_:1})]),_:1})]),_:1}))]),_:1})}}}),ge=S({__name:"my-invite-list",setup(I,{expose:t}){const e=F({pendingInvites:[],submitting:!1,loading:!1}),c=A(()=>e.pendingInvites?e.pendingInvites.filter(a=>a.accept==!0).length:0),v=A(()=>e.pendingInvites?e.pendingInvites.filter(a=>a.accept==!1).length:0),k=A(()=>e.pendingInvites.length),y=A(()=>{const a=c.value>1?`Accept ${c.value} invitations`:c.value>0?"Accept 1 invitation":"",_=v.value>1?`Reject ${v.value} invitations`:v.value>0?"Reject 1 invitation":"",g=c.value>0&&v.value>0?", ":"";return a+g+_});t({invitationsCount:k});async function i(){e.loading=!0;try{let a=await q("/api/person/me/invites",{});if(f.debug(f.context(),"response = ",a),!a.data||a.error)throw new Error(a.error);e.pendingInvites=a.data;const _=R();_.invitationCount=e.pendingInvites.length??0,f.debug(f.context(),"invitationCount=",_.invitationCount)}catch(a){f.error(f.context(),"getInvites error",a)}finally{e.loading=!1}}te(async()=>{await i()});async function d(){let a=[],_=[];try{e.submitting=!0,e.pendingInvites.map(b=>{b.accept===!0?a.push(b.account_id):b.accept===!1&&_.push(b.account_id)});const{error:g}=await H("/api/person/me/invites",{body:{accept_invites:a,reject_invites:_}});if(g){f.error(f.context(),g);return}await i()}finally{e.submitting=!1}}return(a,_)=>{const g=u("v-card-text"),b=u("v-btn"),M=u("v-card-actions"),U=u("v-card");return e.pendingInvites.length>0?(m(),p(U,{key:0,title:"Invitations You Received",loading:e.loading},{default:o(()=>[(m(!0),T(V,null,j(e.pendingInvites,r=>(m(),p(g,{key:r.account_id},{default:o(()=>[l(se,{accept:r.accept,"onUpdate:accept":n=>r.accept=n,inviter:r.inviter,"account-user":r.account_user,"invite-date":new Date(r.invite_date)},null,8,["accept","onUpdate:accept","inviter","account-user","invite-date"])]),_:2},1024))),128)),y.value?(m(),p(M,{key:0},{default:o(()=>[l(b,{block:"",color:"secondary",variant:"elevated",onClick:d,loading:e.submitting},{default:o(()=>[h(N(y.value),1)]),_:1},8,["loading"])]),_:1})):$("",!0)]),_:1},8,["loading"])):$("",!0)}}}),ue={key:0},ce={key:1,class:"text-grey small"},G=S({__name:"account-manager-item",props:{manager:{},pending:{type:Boolean},date:{},revoke:{type:Boolean},currentAccount:{}},emits:["update:revoke"],setup(I){const t=I;function e(i){return x(t.currentAccount.value)?i?"your":"you":t.currentAccount.value.user.given_name+(i?"'s":"")}function c(i){var a;return((a=R().person)==null?void 0:a._id)==i._id||t.currentAccount.value.user._id==i._id}function v(i){return i.given_name+(i.family_name?" "+i.family_name:"")}function k(i,d){return d?i?"Your":"You":i?"your":"you"}function y(i,d,a){var g;return((g=R().person)==null?void 0:g._id)==i._id?k(d,a):v(i)+(d?"'s":"")}return(i,d)=>{const a=u("v-icon"),_=u("v-list-item-title"),g=u("v-list-item-subtitle"),b=u("v-btn"),M=u("v-list-item");return m(),p(M,null,D({prepend:o(()=>[l(O,{picture:i.manager.avatar??void 0,firstName:i.manager.given_name,lastName:i.manager.family_name??"",badgeColor:"transparent","offset-y":"30"},D({_:2},[t.revoke?{name:"badge",fn:o(()=>[l(a,{icon:"mdi-close-thick",color:"error"})]),key:"0"}:void 0]),1032,["picture","firstName","lastName"])]),default:o(()=>[i.revoke?$("",!0):(m(),p(_,{key:0},{default:o(()=>[h(N(y(i.manager,!1,!0)),1)]),_:1})),c(i.manager)?$("",!0):(m(),p(g,{key:1},{default:o(()=>[i.revoke?(m(),T("span",ue," You will "+N(i.pending?"not share":"stop sharing")+" "+N(e(!0))+" sibs data with "+N(y(i.manager,!1,!1)),1)):i.date?(m(),T("span",ce,[h(" Invited "),l(w(z),{time:new Date(i.date),locale:null},null,8,["time"])])):$("",!0)]),_:1}))]),_:2},[c(i.manager)?void 0:{name:"append",fn:o(()=>[i.revoke?(m(),p(b,{key:0,size:"sm",variant:"plain",icon:"mdi-arrow-u-left-top",onClick:d[0]||(d[0]=U=>i.$emit("update:revoke",!1))})):(m(),p(b,{key:1,onClick:d[1]||(d[1]=U=>i.$emit("update:revoke",!0)),color:"success",variant:"tonal",class:"px-2"},{default:o(()=>[l(a,{icon:"mdi-close-thick"}),h(" Revoke ")]),_:1}))]),key:"0"}]),1024)}}}),ve=S({__name:"invitation-form",props:{givenName:{},familyName:{},email:{},emailConfirmation:{},phone:{}},emits:["update:givenName","update:familyName","update:email","update:emailConfirmation","update:phone","update:formOk"],setup(I){const t=I,e=F({formOk:!1});return(c,v)=>{const k=u("v-text-field"),y=u("v-col"),i=u("v-row"),d=u("v-form");return m(),p(d,{class:"pa-1",value:e.formOk,"onUpdate:modelValue":v[5]||(v[5]=a=>c.$emit("update:formOk",a))},{default:o(()=>[l(i,null,{default:o(()=>[l(y,null,{default:o(()=>[l(k,{type:"text",label:"Their first name",id:"givenName",value:t.givenName,"onUpdate:modelValue":v[0]||(v[0]=a=>c.$emit("update:givenName",a)),rules:[w(C).required,w(C).name],required:""},null,8,["value","rules"])]),_:1}),l(y,null,{default:o(()=>[l(k,{type:"text",label:"Their last name",id:"familyName",value:t.familyName,"onUpdate:modelValue":v[1]||(v[1]=a=>c.$emit("update:familyName",a)),rules:[w(C).required,w(C).name],required:""},null,8,["value","rules"])]),_:1})]),_:1}),l(k,{type:"email",label:"Their e-mail",id:"email",value:t.email,"onUpdate:modelValue":v[2]||(v[2]=a=>c.$emit("update:email",a)),rules:[w(C).required,w(C).email],required:""},null,8,["value","rules"]),c.email?(m(),p(k,{key:0,type:"email",label:"Confirm  e-mail",id:"emailConfirmation",value:t.emailConfirmation,"onUpdate:modelValue":v[3]||(v[3]=a=>c.$emit("update:emailConfirmation",a)),rules:[w(C).required,w(C).email,w(C).sameAs(c.email,"e-mails")],required:""},null,8,["value","rules"])):$("",!0),l(k,{type:"tel",label:"Their phone",id:"phone",value:t.phone,"onUpdate:modelValue":v[4]||(v[4]=a=>c.$emit("update:phone",a)),rules:[w(C).phoneOrBlank]},null,8,["value","rules"])]),_:1},8,["value"])}}}),me=S({__name:"account-manager-list",props:{currentAccount:{}},setup(I){const t=I,e=F({expand:!1,submitting:!1,inviting:!1,loading:!1,currentAccountAdmins:[],currentAccountInvites:[],inviteeGivenName:"",inviteeFamilyName:"",inviteeEmail:"",inviteeEmailConfirmation:"",inviteePhone:"",inviteeFormOk:!1,invitePanel:[],inviteError:!1,inviteErrorMsg:"",inviteErrorTitleMsg:""}),c=A(()=>e.currentAccountInvites?e.currentAccountInvites.filter(r=>r.revoke&&r.pending).length:0),v=A(()=>e.currentAccountAdmins?e.currentAccountAdmins.filter(r=>r.revoke&&!r.pending).length:0),k=A(()=>{if(e.currentAccountAdmins==null)return;let r=!1;for(let n of e.currentAccountAdmins)if(n.person._id!=t.currentAccount.value.user._id){r=!0;break}return r}),y=A(()=>k.value?x(t.currentAccount.value)?"You are sharing your sibs data with:":`${a.value} is sharing their sibs data with:`:x(t.currentAccount.value)?"Share your sibs data":`${a.value} is not sharing their sibs data with anyone`),i=A(()=>!k.value&&x(t.currentAccount.value)?"You can invite other people to share your data. They will be able to see your data and help you whenever needed.":""),d=A(()=>{const r=c.value+v.value;return r>1?`Stop sharing with ${r} people`:r>0?`Stop sharing with ${r} person`:""}),a=A(()=>t.currentAccount.value.user.given_name+(t.currentAccount.value.user.family_name?" "+t.currentAccount.value.user.family_name:""));function _(r){return x(t.currentAccount.value)?r?"your":"you":t.currentAccount.value.user.given_name+(r?"'s":"")}ne(t.currentAccount,async()=>{e.currentAccountAdmins=void 0,e.currentAccountInvites=void 0,e.loading=!0;try{await g(),await b()}finally{e.loading=!1}},{immediate:!0});async function g(){const{data:r,error:n}=await q("/api/account/{account_id}/admins",{params:{path:{account_id:t.currentAccount.value.id}}});n&&f.error(f.context(),n),e.currentAccountAdmins=r?r.map(E=>({person:E})):[]}async function b(){const{data:r,error:n}=await q("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}}});n&&f.error(f.context(),n);let E=r?r.filter(P=>P.state==="pending"):[];e.currentAccountInvites=E.map(P=>({person:P.invitee,invite_date:P.invite_date,pending:!0}))}async function M(){let r=[];for(let n of e.currentAccountAdmins??[])n.revoke&&r.push(n.person._id);for(let n of e.currentAccountInvites??[])n.revoke&&r.push(n.person._id);try{if(e.submitting=!0,r.length>0){const{error:n}=await ie("/api/account/{account_id}/invites",{params:{path:{account_id:t.currentAccount.value.id}},body:r});n&&f.error(f.context(),n),await g(),await b()}}finally{e.submitting=!1}}async function U(){var r;try{e.inviting=!0;const n=await H("/api/account/{account_id}/invite",{params:{path:{account_id:t.currentAccount.value.id}},body:{given_name:e.inviteeGivenName,family_name:e.inviteeFamilyName||void 0,email:e.inviteeEmail,phone:e.inviteePhone||void 0}});if(n.error){const E={403:"You can't invite other parties to this account",405:"Maximum number of invites reached for this account",409:"This person is already invited to this account"};e.inviteError=!0,e.inviteErrorMsg=E[n.response.status]??"Error inviting this person",e.inviteErrorTitleMsg="Problem inviting "+e.inviteeGivenName,f.error(f.context(),"inviteError",e.inviteErrorMsg,e.inviteErrorTitleMsg)}else{let E={person:n.data.invitee,invite_date:n.data.invite_date,pending:!0};(r=e.currentAccountInvites)==null||r.push(E),e.inviteeGivenName="",e.inviteeFamilyName="",e.inviteeEmail="",e.inviteeEmailConfirmation="",e.inviteePhone="",e.invitePanel=[],e.inviteError=!1,e.inviteErrorMsg="",e.inviteErrorTitleMsg=""}}finally{e.inviting=!1}}return(r,n)=>{const E=u("v-card-title"),P=u("v-list-subheader"),J=u("v-list"),Y=u("v-card-text"),K=u("v-btn"),Q=u("v-card-actions"),W=u("v-expansion-panel-text"),X=u("v-expansion-panel"),Z=u("v-expansion-panels"),ee=u("v-card");return t.currentAccount.value.user._id?(m(),p(ee,{key:0,color:"surface",loading:e.loading},{default:o(()=>[l(E,{class:"text-wrap"},{default:o(()=>[h(N(y.value),1)]),_:1}),l(Y,null,{default:o(()=>[h(N(i.value)+" ",1),l(J,null,{default:o(()=>[(m(!0),T(V,null,j(e.currentAccountAdmins,s=>(m(),T(V,null,[s.person._id!=t.currentAccount.value.user._id?(m(),p(G,{key:s.person._id??s.person.email,revoke:s.revoke,"onUpdate:revoke":B=>s.revoke=B,manager:s.person,"current-account":t.currentAccount,lines:"two"},null,8,["revoke","onUpdate:revoke","manager","current-account"])):$("",!0)],64))),256)),e.currentAccountInvites&&e.currentAccountInvites.length>0?(m(),p(P,{key:0},{default:o(()=>[h(" Pending")]),_:1})):$("",!0),(m(!0),T(V,null,j(e.currentAccountInvites,s=>(m(),p(G,{key:s.person._id??s.person.email,variant:"tonal",lines:"two",revoke:s.revoke,"onUpdate:revoke":B=>s.revoke=B,manager:s.person,"current-account":t.currentAccount,pending:!0,date:new Date(s.invite_date)},null,8,["revoke","onUpdate:revoke","manager","current-account","date"]))),128))]),_:1})]),_:1}),d.value?(m(),p(Q,{key:0},{default:o(()=>[l(K,{block:"",color:"secondary",variant:"elevated",onClick:M,loading:e.submitting},{default:o(()=>[h(N(d.value),1)]),_:1},8,["loading"])]),_:1})):$("",!0),l(Y,null,{default:o(()=>[l(Z,{multiple:"",modelValue:e.invitePanel,"onUpdate:modelValue":n[9]||(n[9]=s=>e.invitePanel=s)},{default:o(()=>[l(X,{"bg-color":"info-surface",color:"info-surface",value:"invite",title:`Share ${_(!0)} sibs data with another person`},{default:o(()=>[l(W,{id:"expansionPanelText",color:"info-surface"},{default:o(()=>[l(ve,{"given-name":e.inviteeGivenName,"onUpdate:givenName":n[0]||(n[0]=s=>e.inviteeGivenName=s),"family-name":e.inviteeFamilyName,"onUpdate:familyName":n[1]||(n[1]=s=>e.inviteeFamilyName=s),email:e.inviteeEmail,"onUpdate:email":n[2]||(n[2]=s=>e.inviteeEmail=s),"email-confirmation":e.inviteeEmailConfirmation,"onUpdate:emailConfirmation":n[3]||(n[3]=s=>e.inviteeEmailConfirmation=s),phone:e.inviteePhone,"onUpdate:phone":n[4]||(n[4]=s=>e.inviteePhone=s),"onUpdate:formOk":n[5]||(n[5]=s=>e.inviteeFormOk=s)},null,8,["given-name","family-name","email","email-confirmation","phone"]),L("div",null,[l(oe,{"error-msg":e.inviteErrorMsg,"onUpdate:errorMsg":n[6]||(n[6]=s=>e.inviteErrorMsg=s),"error-title":e.inviteErrorTitleMsg,"onUpdate:errorTitle":n[7]||(n[7]=s=>e.inviteErrorTitleMsg=s)},null,8,["error-msg","error-title"]),l(re,{color:"info",block:"",onClick:n[8]||(n[8]=s=>U()),disabled:!e.inviteeFormOk,loading:e.inviting,enabledColor:"info"},{default:o(()=>[h("Invite")]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading"])):$("",!0)}}}),ye=ae(me,[["__scopeId","data-v-d76b341e"]]);export{ye as A,ge as _};
